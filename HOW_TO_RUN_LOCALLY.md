# How to Run Locally

## Prerequisites

**First-time setup:**
```bash
npm install --legacy-peer-deps
```

> **Note:** The `--legacy-peer-deps` flag is required due to a dependency conflict between `zod@^4.3.6` and `openai@4.104.0`. This is safe and doesn't affect functionality.

## Quick Start

**Primary method (recommended):**
```bash
npm run dev
```

This starts the Express server on `http://localhost:3000`

---

## Available Commands

### Development Server
- **`npm run dev`** - Start Express server (port 3000)
  - Serves files from `/public` directory
  - Supports SPA routing (all routes fallback to `index.html`)
  - Output: `ðŸš€ RIG ONLINE: http://localhost:3000`

### Alternative Runners
- **`npm run local`** - Smart runner (tries Firebase emulator first, falls back to Express)
  - Outputs: `ROOT: public` and `URL: http://localhost:3000` (or 5000)
- **`npm run serve:local`** - Static HTTP server (port 5173)
- **`npm run serve:firebase`** - Firebase Hosting emulator (port 5000)

### Build Commands
- **`npm run build`** - Build matrix and tools (generates `public/matrix/seo-matrix.json`)
- **`npm run validate`** - Validate all tool JSON files

---

## What Gets Served

- **Webroot:** `/public` directory
- **Entry Point:** `public/index.html`
- **Static Assets:** `/js`, `/css`, `/data`, `/matrix` directories
- **Routes:**
  - `/` â†’ `index.html`
  - `/insights` â†’ `insights.html` (or `index.html` fallback)
  - `/tools` â†’ `tools.html` (or `index.html` fallback)
  - `/search` â†’ `search.html` (or `index.html` fallback)
  - All other routes â†’ `index.html` (SPA fallback)

---

## Troubleshooting

### Port Already in Use
If port 3000 is busy:
```bash
# Windows: Find and kill process
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# Or use a different port
set PORT=3001
npm run dev
```

### Missing Matrix File
If you see 404s for `/matrix/seo-matrix.json`:
```bash
npm run build
```

### Server Won't Start
1. Check that `public/index.html` exists
2. Check that `server.cjs` exists in root
3. Verify Node.js version: `node --version` (requires >=18.0.0)

---

## File Structure

```
â”œâ”€â”€ server.cjs          # Express server (port 3000)
â”œâ”€â”€ public/             # Webroot
â”‚   â”œâ”€â”€ index.html      # Main entry point
â”‚   â”œâ”€â”€ js/             # JavaScript files
â”‚   â”œâ”€â”€ css/            # Stylesheets
â”‚   â”œâ”€â”€ data/           # JSON data files
â”‚   â””â”€â”€ matrix/         # Matrix JSON (generated by build)
â”œâ”€â”€ config/             # Configuration files
â””â”€â”€ scripts/            # Build and utility scripts
```

---

## Notes

- **Analytics:** GA4 is loaded via `/js/analytics.js` (single entry point, no duplicates)
- **Environment:** Server detects localhost and disables analytics in local mode
- **Hot Reload:** Not included - restart server after file changes
- **Build Required:** Matrix file must be built before some features work

---

## Production vs Local

- **Local:** Analytics disabled automatically
- **Production:** Analytics enabled (hostname: `rideyourdemons.com`)
- **Firebase:** Uses `firebase.json` for routing rules (same as production)
